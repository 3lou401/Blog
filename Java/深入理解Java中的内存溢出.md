


# 内存溢出
程序运行过程中无法申请到足够的内存而导致的一种错误。

# 内存溢出的几种情况（OOM 异常）

OutOfMemoryError 异常：
除了程 序计数器外 ， 虚拟机内 存的其他几 个运行时区 域都有发生OutOfMemoryError(OOM)异常的可能。

- 1.虚拟机栈和本地方法栈溢出
如果线程请求的栈深度大于虚拟机所允许的最大深度，将抛出StackOverflowError 异常。
如果虚拟机在扩展栈时无法申请到足够的内存空间 ，则抛出OutOfMemoryError异常。

- 2.堆溢出
一般的异常信息： java.lang.OutOfMemoryError:Java heap spaces。
出现这种异常， 一般手段是先通过内存映像分析工具(如 Eclipse Memory
Analyzer)对 dump 出来的堆转存快照进行分析， 重点是确认内存中的对象是否是必要的， 先分清是因为内存泄漏(Memory Leak)还是内存溢出(MemoryOverflow)。
如果是内存泄漏， 可进一步通过工具查看泄漏对象到 GC Roots 的引用链。于是就能找到泄漏对象是通过怎样的路径与 GC Roots 相关联并导致垃圾收集器无法自动回收。
如果不存在泄漏， 那就应该检查虚拟机的参数(-Xmx 与-Xms)的设置是否适当

- 3.方法区溢出
异常信息： java.lang.OutOfMemoryError:PermGen space。

- 4.运行时常量池溢出
异常信息： java.lang.OutOfMemoryError:PermGen space。


如 果 要 向 运 行 时 常 量 池 中 添 加 内 容 ， 最 简 单 的 做 法 就 是 使 用
String.intern()这个 Native 方法。

 该方法的作用是： 如果池中已经包含一个等于此 String 的字符串， 则返回代表池中这个字符串的 String 对象； 否则，将此 String 对象包含的字符串添加到常量池中， 并且返回此 String 对象的引用 。 由 于 常 量 池 分 配 在 方 法 区 内 ， 我 们 可 以 通 过 -XX:PermSize 和-XX:MaxPermSize 限制方法区的大小， 从而间接限制其中常量池的容量。

# 导致内存溢出的原因
- 1.内存中加载的数据量过于庞大， 如一次从数据库取出过多数据；
- 2.集合类中有对对象的引用， 使用完后未清空， 使得 JVM 不能回收；
- 3.代码中存在死循环或循环产生过多重复的对象实体；
- 4.启动参数内存值设定的过小。

# 内存溢出的解决方法
- 第一步， 修改 JVM 启动参数， 直接增加内存。 (-Xms， -Xmx 参数一定不要忘记加。一般要将-Xms 和-Xmx 选项设置为相同， 以避免在每次 GC 后调整堆的大小； 建议堆的最大值设置为可用内存的最大值的 80%)。
- 第二步， 检查错误日志， 查看“OutOfMemory” 错误前是否有其它异常或错误。
- 第三步， 对代码进行走查和分析， 找出可能发生内存溢出的位置。
- 第四步， 使用内存查看工具动态查看内存使用情况（Jconsole）

> 基本上如果抛出 OutOfMemory 有两种原因： 1.内存泄露。 2.应用程序本身
就是需要这么多的内存。
